{% extends 'base.html.twig' %}

{% block title %}Locallo, c'est parti !{% endblock %}

{% block body %}
    {% for flash_error in app.flashes('verify_email_error') %}
        <div class="alert alert-danger" role="alert">{{ flash_error }}</div>
    {% endfor %}

    <div class="container mt-4">
        <h1 class="text-center">Inscription</h1>

        {{ form_errors(registrationForm) }}

        {{ form_start(registrationForm) }}
            <div class="col-md-8 mx-auto my-4">
                <div class="mt-4 mb-4 mx-auto" style="width: 50%; max-width: 500px;">
                    <h3 class="text-center">Informations personnelles</h3>
                    <div class="row-cols-2 form-field-spaced">
                        {{ form_label(registrationForm.username, 'Nom d\'utilisateur :') }}
                        {{ form_widget(registrationForm.username)}}
                        {{ form_errors(registrationForm.username) }}
                    </div>
                    <div class="row-cols-2 form-field-spaced">
                        {{ form_label(registrationForm.email, 'Email :') }}
                        {{ form_widget(registrationForm.email)}}
                        {{ form_errors(registrationForm.email) }}
                    </div>
                    <div class="row-cols-2 form-field-spaced">
                        {{ form_label(registrationForm.plainPassword, 'Mot de passe :') }}
                        {{ form_widget(registrationForm.plainPassword)}}
                        {{ form_errors(registrationForm.plainPassword) }}
                    </div>
                    <div class="row-cols-2 form-field-spaced">
                        {{ form_label(registrationForm.agreeTerms, 'Conditions d\'utilisation :') }}
                        {{ form_widget(registrationForm.agreeTerms)}}
                        {{ form_errors(registrationForm.agreeTerms) }}
                    </div>
                </div>
                <div class="mt-4 mb-4 mx-auto" style="width: 50%; max-width: 500px;">
                    <h3 class="text-center">Votre activité</h3>
                    <div class="col form-field-spaced">
                        {{ form_label(registrationForm.isSuperUser, 'Vous souhaitez apparaître dans notre annuaire ? :') }}
                        {{ form_widget(registrationForm.isSuperUser)}}
                        {{ form_errors(registrationForm.isSuperUser) }}
                    </div>
                    <div id="activity-fields" style="display: none;">
                        <h4 class="text-center">Informations sur votre activité</h4>
                        <div class="row">
                            {{ form_label(registrationForm.activityName, 'Nom de votre activité :') }}
                            {{ form_widget(registrationForm.activityName)}}
                            {{ form_errors(registrationForm.activityName) }}
                        </div>
                        <div class="row">
                            {{ form_label(registrationForm.activityDescription, 'Description de votre activité :') }}
                            {{ form_widget(registrationForm.activityDescription)}}
                            {{ form_errors(registrationForm.activityDescription) }}
                        </div>
                        <div class="row">
                            {{ form_label(registrationForm.activityCategory, 'Catégorie de votre activité :') }}
                            {{ form_widget(registrationForm.activityCategory)}}
                            {{ form_errors(registrationForm.activityCategory) }}
                        </div>
                        <div class="row-cols-2 mt-2 mb-2 form-field-spaced">
                            {{ form_label(registrationForm.superUserAgreeTerms, 'conditions d\'utilisation :') }}
                            {{ form_widget(registrationForm.superUserAgreeTerms)}}
                            {{ form_errors(registrationForm.superUserAgreeTerms) }}
                        </div>
                        <div class="row-cols-2 form-field-spaced">
                            {{ form_label(registrationForm.hasOnlineShop, 'créer votre boutique en ligne ? :') }}
                            {{ form_widget(registrationForm.hasOnlineShop)}}
                            {{ form_errors(registrationForm.hasOnlineShop) }}
                        </div>        
                    </div>
                    <div class="mt-4 mb-4" id="shop-fields" style="display: none;">
                        <h5 class="text-center" style="margin-bottom: 20px;">Boutique en ligne</h5>
                        <div class="row-cols-2 form-field-spaced">
                            {{ form_label(registrationForm.shopAgreeTerms, 'conditions d\'utilisation :') }}
                            {{ form_widget(registrationForm.shopAgreeTerms)}}
                            {{ form_errors(registrationForm.shopAgreeTerms) }}
                        </div>
                        <div class="row">
                            <p class="text-muted">Vous pourrez ajouter vos produits plus tard dans votre dashboard.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-center">
                <button type="submit" class="btn btn-primary btn-lg">Créer mon compte</button>
            </div>
        {{ form_end(registrationForm) }}
    </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script>
        // Gestion du formulaire d'inscription avec champs conditionnels
        function toggleUserTypeFields() {
            console.log('toggleUserTypeFields appelée');
            
            // Chercher les éléments
            const superUserCheckbox = document.querySelector('input[name="registration_form[isSuperUser]"]');
            const shopCheckbox = document.querySelector('input[name="registration_form[hasOnlineShop]"]');
            const activityContainer = document.getElementById('activity-fields');
            const shopContainer = document.getElementById('shop-fields');
            
            console.log('SuperUser checkbox:', superUserCheckbox);
            console.log('Shop checkbox:', shopCheckbox);
            console.log('Activity container:', activityContainer);
            console.log('Shop container:', shopContainer);
            
            if (superUserCheckbox && activityContainer) {
                if (superUserCheckbox.checked) {
                    console.log('SuperUser activé - affichage des champs d\'activité');
                    activityContainer.style.display = 'block';
                    
                    // Rendre les champs d'activité requis
                    const activityFields = activityContainer.querySelectorAll('input, select, textarea');
                    activityFields.forEach(field => {
                        field.required = true;
                    });
                    
                    // Gérer la boutique en ligne
                    if (shopCheckbox && shopContainer) {
                        if (shopCheckbox.checked) {
                            console.log('Boutique en ligne activée');
                            shopContainer.style.display = 'block';
                        } else {
                            console.log('Boutique en ligne désactivée');
                            shopContainer.style.display = 'none';
                        }
                    }
                } else {
                    console.log('SuperUser désactivé - masquage des champs');
                    activityContainer.style.display = 'none';
                    if (shopContainer) shopContainer.style.display = 'none';
                    
                    // Enlever l'obligation et vider les champs
                    const allFields = document.querySelectorAll('.activity-field, .shop-field');
                    allFields.forEach(field => {
                        field.required = false;
                        field.value = '';
                    });
                }
            }
        }
        
        function toggleShopFields() {
            const shopCheckbox = document.querySelector('input[name="registration_form[hasOnlineShop]"]');
            const shopContainer = document.getElementById('shop-fields');
            
            if (shopCheckbox && shopContainer) {
                if (shopCheckbox.checked) {
                    shopContainer.style.display = 'block';
                } else {
                    shopContainer.style.display = 'none';
                    // Vider les champs de boutique
                    const shopFields = shopContainer.querySelectorAll('input, select, textarea');
                    shopFields.forEach(field => {
                        field.value = '';
                    });
                }
            }
        }

        // Initialiser au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM chargé');
            toggleUserTypeFields();
            
            // Ajouter les événements
            const superUserCheckbox = document.querySelector('input[name="registration_form[isSuperUser]"]');
            const shopCheckbox = document.querySelector('input[name="registration_form[hasOnlineShop]"]');
            
            if (superUserCheckbox) {
                superUserCheckbox.addEventListener('change', toggleUserTypeFields);
                console.log('Événement ajouté au SuperUser checkbox');
            }
            
            if (shopCheckbox) {
                shopCheckbox.addEventListener('change', toggleShopFields);
                console.log('Événement ajouté au Shop checkbox');
            }
        });
    </script>
{% endblock %}
